<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapéu Seletor IFMSA</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Estilos Personalizados e Animações -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:ital,wght@0,400;0,700;1,400&display=swap');

    .font-magic { font-family: 'Cinzel', serif; }
    .font-body { font-family: 'Lato', sans-serif; }

    @keyframes float-up {
      0% { transform: translateY(110vh) scale(0) rotate(0deg); opacity: 0; }
      20% { opacity: 0.8; }
      100% { transform: translateY(-10vh) scale(1.5) rotate(360deg); opacity: 0; }
    }
    @keyframes float-card {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    @keyframes magic-pulse {
      0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); transform: scale(1); }
      50% { box-shadow: 0 0 30px 10px rgba(245, 158, 11, 0); transform: scale(1.03); }
      100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); transform: scale(1); }
    }
    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    @keyframes fog-move {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes slide-in-stagger {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes animFadeZoom {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes animFadeZoomSlide {
      from { opacity: 0; transform: scale(0.95) translateY(3rem); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    
    .anim-entrance { animation: animFadeZoom 1s ease-out forwards; }
    .anim-entrance-result { animation: animFadeZoomSlide 1s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

    .particle {
      position: fixed;
      background: radial-gradient(circle, #fbbf24 0%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
      animation: float-up linear infinite;
    }
    
    .magic-click {
      animation: magic-pulse 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      border-color: #fbbf24 !important;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
      color: #fbbf24 !important;
    }
    
    .shimmer-text {
      background: linear-gradient(90deg, #fcd34d 0%, #fff 40%, #fcd34d 80%);
      background-size: 200% auto;
      color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
      animation: shimmer 4s linear infinite;
    }
    
    .animated-bg {
      background-size: 400% 400%;
      animation: fog-move 30s ease-in-out infinite;
    }

    .floating-card {
      animation: float-card 6s ease-in-out infinite;
    }

    .stagger-1 { animation: slide-in-stagger 0.5s ease-out 0.1s backwards; }
    .stagger-2 { animation: slide-in-stagger 0.5s ease-out 0.2s backwards; }
    .stagger-3 { animation: slide-in-stagger 0.5s ease-out 0.3s backwards; }
    .stagger-4 { animation: slide-in-stagger 0.5s ease-out 0.4s backwards; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-indigo-950 via-slate-950 to-black animated-bg flex flex-col items-center justify-center p-4 overflow-hidden relative font-body text-stone-200 selection:bg-amber-900 selection:text-amber-100">
  
  <!-- Partículas Mágicas (injetadas via JS) -->
  <div id="particles-container"></div>

  <!-- Camada de Vinheta e Ruído Visual -->
  <div class="fixed inset-0 pointer-events-none opacity-20 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] z-0"></div>
  <div class="fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.4)_100%)] z-0"></div>

  <!-- Container Principal do App -->
  <div id="app" class="w-full flex justify-center relative z-10"></div>

  <!-- Script da Aplicação -->
  <script>
    // --- 1. DADOS DOS COMITÊS ---
    const COMMITTEES = {
      SCOME: {
        id: 'SCOME', name: 'SCOME', fullName: 'Educação Médica',
        color: 'bg-blue-900', textColor: 'text-blue-900',
        icon: 'book-open',
        description: 'Sua varinha é guiada pelo conhecimento. Seu foco é a biblioteca, o aprimoramento dos feitiços de cura e garantir que todo bruxo receba um ensino de excelência.',
        tags: ['Sabedoria', 'Ensino', 'Feitiços']
      },
      SCOPH: {
        id: 'SCOPH', name: 'SCOPH', fullName: 'Saúde Pública',
        color: 'bg-orange-700', textColor: 'text-orange-800',
        icon: 'users',
        description: 'Sua magia cura multidões. Você se destaca na Herbologia e no preparo de poções preventivas para proteger vilarejos inteiros contra pragas mágicas.',
        tags: ['Prevenção', 'Poções', 'Comunidade']
      },
      SCORA: {
        id: 'SCORA', name: 'SCORA', fullName: 'Saúde Sexual e Reprodutiva',
        color: 'bg-red-800', textColor: 'text-red-900',
        icon: 'heart',
        description: 'Você tem a coragem de quebrar maldições antigas e tabus de puro-sangue. Luta pelo amor livre, pela diversidade e contra qualquer forma de estigma.',
        tags: ['Coragem', 'Diversidade', 'Amor']
      },
      SCORP: {
        id: 'SCORP', name: 'SCORP', fullName: 'Direitos Humanos e Paz',
        color: 'bg-green-800', textColor: 'text-green-900',
        icon: 'globe',
        description: 'Sua empatia é um escudo impenetrável. Você acolhe os vulneráveis, defende elfos e trouxas, e luta incessantemente contra as Artes das Trevas.',
        tags: ['Paz', 'Refúgio', 'Defesa']
      }
    };

    // --- 2. PERGUNTAS (UNIVERSO HARRY POTTER) ---
    const QUESTIONS = [
      {
        question: "Um trasgo invadiu as masmorras de Hogwarts. Qual a sua primeira reação?",
        options: [
          { text: "Ajudo a evacuar os alunos mais novos e a proteger os indefesos.", weights: { SCORP: 3, SCOPH: 1 } },
          { text: "Lembro do capítulo 4 de Defesa Contra as Artes das Trevas e oriento o feitiço exato.", weights: { SCOME: 3 } },
          { text: "Tento entender por que o trasgo está com raiva; talvez sofra preconceito.", weights: { SCORA: 3, SCORP: 1 } },
          { text: "Corro para a Ala Hospitalar preparar poções de cura para possíveis feridos.", weights: { SCOPH: 3 } }
        ]
      },
      {
        question: "Qual dessas aulas em Hogwarts te atrai mais?",
        options: [
          { text: "Herbologia: cultivando plantas que podem curar febres de toda a escola.", weights: { SCOPH: 3 } },
          { text: "Trato das Criaturas Mágicas: quebrando estigmas sobre seres incompreendidos.", weights: { SCORA: 3 } },
          { text: "História da Magia e Feitiços: buscando a excelência acadêmica e os porquês.", weights: { SCOME: 3 } },
          { text: "Defesa Contra as Artes das Trevas: focando em proteger o mundo bruxo.", weights: { SCORP: 3 } }
        ]
      },
      {
        question: "Você encontrou a Sala Precisa. O que ela se torna para você?",
        options: [
          { text: "Uma biblioteca infinita com métodos revolucionários de ensino mágico.", weights: { SCOME: 3 } },
          { text: "Um refúgio seguro e impenetrável para aqueles que fogem da guerra bruxa.", weights: { SCORP: 3 } },
          { text: "Um espaço livre de julgamentos onde todos podem ser quem realmente são.", weights: { SCORA: 3 } },
          { text: "Uma estufa gigante produzindo ingredientes para curar vilarejos inteiros.", weights: { SCOPH: 3 } }
        ]
      },
      {
        question: "O Ministério da Magia quer aprovar uma nova lei. Qual te faria protestar violentamente?",
        options: [
          { text: "Uma lei que proíbe casamentos entre bruxos e trouxas (puro-sangue).", weights: { SCORA: 3, SCORP: 1 } },
          { text: "O corte de verbas para o Hospital St. Mungus e poções preventivas.", weights: { SCOPH: 3 } },
          { text: "A censura e proibição de livros essenciais na biblioteca de Hogwarts.", weights: { SCOME: 3 } },
          { text: "A deportação forçada de bruxos refugiados vindos de outros países.", weights: { SCORP: 3, SCORA: 1 } }
        ]
      },
      {
        question: "Qual criatura mágica você adotaria ou faria campanhas para defender?",
        options: [
          { text: "Um lobisomem, lutando contra o estigma e o isolamento que a sociedade lhe impõe.", weights: { SCORA: 3 } },
          { text: "Um testrálio, estudando como ajudam na saúde mental de quem já viu a morte.", weights: { SCOPH: 3, SCOME: 1 } },
          { text: "Um elfo doméstico, criando o F.A.L.E. e exigindo direitos e liberdade.", weights: { SCORP: 3 } },
          { text: "Uma coruja muito inteligente, perfeita para enviar pergaminhos e orientar alunos.", weights: { SCOME: 3 } }
        ]
      },
      {
        question: "O que o Espelho de Ojesed (que mostra seu desejo mais profundo) revelaria a você?",
        options: [
          { text: "Comunidades bruxas 100% saudáveis, erradicando a varíola de dragão.", weights: { SCOPH: 3 } },
          { text: "Eu como o maior mestre de Hogwarts, revolucionando o ensino.", weights: { SCOME: 3 } },
          { text: "Um mundo pacífico e igualitário, sem Lordes das Trevas ou guerras.", weights: { SCORP: 3 } },
          { text: "Pessoas amando livremente, sem precisarem se esconder nas sombras.", weights: { SCORA: 3 } }
        ]
      },
      {
        question: "Para qual setor do Hospital St. Mungus para Doenças e Acidentes Mágicos você iria trabalhar?",
        options: [
          { text: "Traumas causados por Artefatos das Trevas e Maldições Imperdoáveis.", weights: { SCORP: 3 } },
          { text: "O setor de Pesquisa, Currículo e Treinamento de novos Curandeiros.", weights: { SCOME: 3 } },
          { text: "Controle de Doenças Contagiosas e Feitiços Infecciosos de ampla escala.", weights: { SCOPH: 3 } },
          { text: "Ala de transições corporais complexas e saúde sexual mágica.", weights: { SCORA: 3 } }
        ]
      },
      {
        question: "Se você fundasse a 'Armada de Dumbledore', qual seria o objetivo principal do grupo?",
        options: [
          { text: "Garantir que os alunos aprendam o que o Ministério tentou censurar no currículo.", weights: { SCOME: 3 } },
          { text: "Treinar feitiços de proteção e defesa para ajudar bruxos nascidos-trouxas.", weights: { SCORP: 3 } },
          { text: "Criar uma rede de apoio seguro e discutir tabus que os professores evitam.", weights: { SCORA: 3 } },
          { text: "Organizar mutirões para limpar áreas contaminadas por pragas na Floresta Proibida.", weights: { SCOPH: 3 } }
        ]
      },
      {
        question: "O Profeta Diário publicou uma 'fake news' criminosa. Qual sua reação?",
        options: [
          { text: "Escrevo para o Pasquim desmentindo os ataques e preconceitos contra as minorias.", weights: { SCORA: 3, SCORP: 1 } },
          { text: "Faço campanhas em Hogwarts ensinando as medidas reais de prevenção contra a mentira.", weights: { SCOPH: 3 } },
          { text: "Exijo que a escola ensine 'Leitura Crítica de Pergaminhos' urgentemente.", weights: { SCOME: 3 } },
          { text: "Organizo um protesto pacífico no Ministério contra a disseminação de medo.", weights: { SCORP: 3 } }
        ]
      },
      {
        question: "Seu bicho-papão assume a forma do seu maior medo. Ele seria:",
        options: [
          { text: "Uma epidemia letal de Escrofulária que ninguém consegue controlar.", weights: { SCOPH: 3 } },
          { text: "Ver inocentes sofrendo em uma nova guerra bruxa sem poder ajudar.", weights: { SCORP: 3 } },
          { text: "Tirar 'Trasgo' (T) nos exames e se tornar um curandeiro medíocre.", weights: { SCOME: 3 } },
          { text: "Um mundo opressor onde todos são forçados a esconder sua verdadeira identidade.", weights: { SCORA: 3 } }
        ]
      },
      {
        question: "É época de N.O.M.s (Níveis Ordinários de Magia). Como você age na Sala Comunal?",
        options: [
          { text: "Crio cronogramas de estudo impecáveis e dou monitoria para os mais novos.", weights: { SCOME: 3 } },
          { text: "Indigno-me com a pressão e o colapso mental causado pelas avaliações do Ministério.", weights: { SCORP: 3, SCOME: 1 } },
          { text: "Preparo chás de camomila mágica e poções calmantes para evitar surtos de estresse.", weights: { SCOPH: 3 } },
          { text: "Questiono por que as provas de poções costumam subestimar alunas bruxas.", weights: { SCORA: 3 } }
        ]
      },
      {
        question: "Você descobriu uma nova e poderosa poção! O que ela faz?",
        options: [
          { text: "Permite sentir o que o outro sente, gerando empatia instantânea contra o preconceito.", weights: { SCORA: 3, SCORP: 1 } },
          { text: "Aumenta a clareza mental, facilitando o aprendizado e o ensino de feitiços complexos.", weights: { SCOME: 3 } },
          { text: "Cria um escudo impenetrável contra torturas, focado em proteger vítimas de guerra.", weights: { SCORP: 3 } },
          { text: "Atua como uma vacina universal, imunizando vilarejos inteiros com uma só gota.", weights: { SCOPH: 3 } }
        ]
      }
    ];

    // --- 3. VARIÁVEIS DE ESTADO ---
    let currentQuestion = 0;
    let scores = { SCOME: 0, SCOPH: 0, SCORA: 0, SCORP: 0 };
    let animateOption = null;

    // --- 4. FUNÇÕES DO SISTEMA ---
    const app = document.getElementById('app');

    function initParticles() {
      const container = document.getElementById('particles-container');
      for (let i = 0; i < 25; i++) {
        const p = document.createElement('div');
        p.className = 'particle opacity-50';
        p.style.left = `${Math.random() * 100}%`;
        p.style.width = `${Math.random() * 3 + 2}px`;
        p.style.height = p.style.width;
        p.style.animationDuration = `${Math.random() * 15 + 10}s`;
        p.style.animationDelay = `${Math.random() * 5}s`;
        p.style.bottom = '-20px';
        container.appendChild(p);
      }
    }

    function renderWelcome() {
      app.innerHTML = `
        <div class="max-w-xl w-full relative z-10 anim-entrance px-4">
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[140%] h-[140%] bg-gradient-to-r from-amber-500/5 to-purple-500/5 rounded-full blur-3xl animate-pulse -z-10 pointer-events-none"></div>

          <div class="relative bg-slate-900/60 backdrop-blur-xl rounded-t-[3rem] rounded-b-[3rem] border border-amber-500/30 p-12 text-center shadow-[0_0_80px_rgba(0,0,0,0.6)] overflow-hidden group">
            <div class="absolute inset-0 rounded-[3rem] border border-amber-500/20 pointer-events-none"></div>
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-2/3 h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent opacity-50 shadow-[0_0_20px_rgba(245,158,11,1)]"></div>
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent opacity-20"></div>

            <div class="relative z-10 flex flex-col items-center">
              <div class="mb-10 relative group-hover:-translate-y-2 transition-transform duration-700 ease-in-out">
                <div class="absolute inset-0 bg-amber-500 blur-[50px] opacity-20 rounded-full animate-pulse"></div>
                <div class="absolute inset-0 border border-amber-500/20 rounded-full animate-[spin_10s_linear_infinite]"></div>
                <div class="absolute -inset-4 border border-amber-500/10 rounded-full animate-[spin_15s_linear_infinite_reverse]"></div>

                <div class="relative bg-slate-950 p-6 rounded-2xl border border-amber-500/40 shadow-[0_0_40px_rgba(245,158,11,0.15)] floating-card">
                  <i data-lucide="scroll" class="w-20 h-20 text-amber-400 drop-shadow-[0_0_15px_rgba(245,158,11,0.5)]"></i>
                  <i data-lucide="sparkles" class="absolute -top-3 -right-3 w-8 h-8 text-amber-200 animate-pulse"></i>
                </div>
              </div>
              
              <h1 class="text-5xl md:text-7xl font-black mb-4 font-magic text-transparent bg-clip-text bg-gradient-to-b from-amber-100 via-amber-300 to-amber-600 drop-shadow-sm tracking-tighter leading-[0.9]">
                Chapéu<br/>Seletor
              </h1>
              
              <div class="flex items-center gap-4 w-full justify-center opacity-60 mb-8">
                 <div class="h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent w-16"></div>
                 <span class="text-amber-200 font-magic tracking-[0.3em] text-xs uppercase">IFMSA Brazil</span>
                 <div class="h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent w-16"></div>
              </div>

              <p class="text-stone-300 mb-12 text-lg italic font-body leading-relaxed max-w-sm mx-auto opacity-90">
                "Os comitês aguardam. Diga-me quem és, e eu te mostrarei o teu lugar."
              </p>
              
              <button onclick="renderQuiz()" class="group/btn relative w-full max-w-xs mx-auto overflow-hidden rounded-xl bg-gradient-to-r from-amber-700 to-amber-600 p-[1px] shadow-2xl transition-all hover:scale-[1.02] hover:shadow-amber-900/50">
                <div class="absolute inset-0 bg-gradient-to-r from-amber-600 to-amber-500 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-500"></div>
                <div class="relative h-full bg-slate-950 rounded-xl p-4 flex items-center justify-center gap-3 group-hover/btn:bg-slate-900 transition-colors">
                  <i data-lucide="wand-2" class="w-6 h-6 text-amber-400 group-hover/btn:text-amber-200 group-hover/btn:rotate-12 transition-all duration-300"></i>
                  <span class="font-magic font-bold text-xl text-amber-100 tracking-widest group-hover/btn:text-white">
                    INICIAR RITO
                  </span>
                </div>
              </button>

              <!-- Créditos -->
              <div class="mt-10 w-full flex flex-col items-center border-t border-amber-500/20 pt-6 opacity-80">
                 <h3 class="text-amber-200 font-magic text-sm tracking-[0.2em] uppercase mb-1 text-center drop-shadow-sm">
                   IFMSA Brazil UniEVANGÉLICA
                 </h3>
                 <a href="https://instagram.com/ifmsabrazil_unievangelica" target="_blank" rel="noopener noreferrer" class="text-amber-500/80 font-body text-xs tracking-wider hover:text-amber-300 transition-colors mb-4">
                   @ifmsabrazil_unievangelica
                 </a>
                 <p class="text-stone-400 font-body text-[10px] tracking-widest uppercase">
                   Criado por: <span class="text-amber-600/90 font-bold">Gerley Adriano</span> <a href="https://instagram.com/g3rley" target="_blank" rel="noopener noreferrer" class="hover:text-amber-400 transition-colors">@g3rley</a>
                 </p>
              </div>
            </div>
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    function renderQuiz() {
      const q = QUESTIONS[currentQuestion];
      const progress = ((currentQuestion + 1) / QUESTIONS.length) * 100;
      
      const optionsHtml = q.options.map((opt, idx) => `
        <button id="opt-${idx}" onclick="handleAnswer(${idx})" class="w-full text-left p-5 md:p-6 border-2 transition-all duration-300 font-medium text-lg relative overflow-hidden group rounded-md stagger-${idx + 1} bg-[#fcfaf5]/80 text-stone-800 border-stone-300 hover:border-amber-600 hover:text-amber-900 hover:bg-white hover:shadow-[0_4px_20px_rgba(251,191,36,0.25)] hover:-translate-y-1">
          <span class="relative z-10 flex items-center justify-between">
            ${opt.text}
            <i data-lucide="sparkles" id="sparkle-${idx}" class="hidden w-6 h-6 animate-spin text-amber-400 drop-shadow-[0_0_8px_rgba(251,191,36,1)]"></i>
          </span>
        </button>
      `).join('');

      app.innerHTML = `
        <div id="quiz-container" class="max-w-lg w-full relative z-10 flex flex-col gap-8 transition-all duration-500 opacity-100 translate-y-0 blur-0">
          
          <div class="flex justify-between items-end px-2 text-amber-200/90 font-magic">
            <span class="text-lg tracking-wider">Pergaminho ${currentQuestion + 1}</span>
            <span class="text-xs border border-amber-500/30 px-3 py-1 rounded-full bg-slate-900/60 backdrop-blur-sm tracking-widest">
              ${QUESTIONS.length - currentQuestion} RESTANTES
            </span>
          </div>
          
          <div class="relative w-full h-3 bg-slate-900/50 rounded-full border border-slate-700/50 backdrop-blur-sm shadow-inner">
             <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-amber-900 via-amber-600 to-amber-300 rounded-full shadow-[0_0_15px_rgba(245,158,11,0.5)] transition-all duration-1000 ease-out" style="width: ${progress}%">
              <div class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 w-4 h-4 bg-white rounded-full blur-[6px]"></div>
              <div class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 w-2 h-2 bg-amber-100 rounded-full"></div>
            </div>
          </div>

          <div class="bg-[#f0e6d2] rounded-lg p-8 md:p-10 shadow-2xl border-2 border-stone-400 relative overflow-hidden">
             <div class="absolute inset-0 opacity-15 bg-[url('https://www.transparenttextures.com/patterns/aged-paper.png')] mix-blend-multiply pointer-events-none"></div>
             
             <div class="absolute top-0 left-0 w-16 h-16 border-t-4 border-l-4 border-amber-700/20 rounded-tl-3xl pointer-events-none"></div>
             <div class="absolute bottom-0 right-0 w-16 h-16 border-b-4 border-r-4 border-amber-700/20 rounded-br-3xl pointer-events-none"></div>

             <h2 class="relative text-2xl md:text-3xl font-bold text-stone-900 mb-8 leading-snug text-center font-magic drop-shadow-sm">
               ${q.question}
             </h2>
            
             <div class="space-y-4 relative font-body">
              ${optionsHtml}
            </div>
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    window.handleAnswer = function(idx) {
      if (animateOption !== null) return;
      animateOption = idx;

      const q = QUESTIONS[currentQuestion];

      // Efeitos no botão selecionado
      const clickedBtn = document.getElementById(`opt-${idx}`);
      clickedBtn.classList.add('magic-click', 'z-20', 'scale-[1.02]', 'shadow-xl');
      clickedBtn.classList.remove('bg-[#fcfaf5]/80', 'text-stone-800', 'hover:border-amber-600', 'hover:text-amber-900', 'hover:bg-white', 'hover:-translate-y-1');
      document.getElementById(`sparkle-${idx}`).classList.remove('hidden');

      // Escurecer outras opções
      q.options.forEach((_, i) => {
        if (i !== idx) {
          const otherBtn = document.getElementById(`opt-${i}`);
          otherBtn.classList.add('opacity-40', 'blur-[1px]');
          otherBtn.classList.remove('hover:border-amber-600', 'hover:text-amber-900', 'hover:bg-white', 'hover:-translate-y-1');
          otherBtn.disabled = true;
        }
      });

      // Somar Pontos
      const weights = q.options[idx].weights;
      Object.keys(weights).forEach(key => {
        if (scores[key] !== undefined) scores[key] += weights[key];
      });

      // Transição Mágica
      setTimeout(() => {
        const quizContainer = document.getElementById('quiz-container');
        quizContainer.classList.remove('opacity-100', 'translate-y-0', 'blur-0');
        quizContainer.classList.add('opacity-0', 'translate-y-4', 'blur-sm');

        setTimeout(() => {
          animateOption = null;
          currentQuestion++;
          if (currentQuestion < QUESTIONS.length) {
            renderQuiz();
          } else {
            renderCalculating();
          }
        }, 400); 
      }, 700);
    };

    function renderCalculating() {
      app.innerHTML = `
        <div class="text-center relative z-10 anim-entrance flex flex-col items-center">
          <div class="relative mb-8">
             <div class="absolute inset-0 bg-amber-500 blur-[60px] opacity-20 animate-pulse rounded-full"></div>
             <div class="relative">
               <div class="absolute inset-0 animate-ping opacity-30">
                 <i data-lucide="sparkles" class="w-24 h-24 text-amber-300"></i>
               </div>
               <i data-lucide="sparkles" class="w-24 h-24 text-amber-400 animate-[spin_4s_linear_infinite] drop-shadow-[0_0_25px_rgba(251,191,36,0.8)]"></i>
             </div>
          </div>
          
          <h2 class="text-5xl font-magic font-bold text-transparent bg-clip-text bg-gradient-to-b from-amber-100 to-amber-500 tracking-widest drop-shadow-lg mb-4">
            O Chapéu Delibera
          </h2>
          
          <div class="flex gap-2 justify-center items-center">
             <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce" style="animation-delay: -0.3s"></div>
             <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce" style="animation-delay: -0.15s"></div>
             <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce"></div>
          </div>
          <p class="text-amber-200/80 italic text-xl mt-4 font-body animate-pulse">Lendo a essência da sua alma...</p>
        </div>
      `;
      lucide.createIcons();

      setTimeout(() => {
        renderResult();
      }, 3000);
    }

    function renderResult() {
      const sorted = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
      const primary = COMMITTEES[sorted[0]];
      const secondary = [COMMITTEES[sorted[1]], COMMITTEES[sorted[2]]];

      const tagsHtml = primary.tags.map((tag, i) => `
        <span class="px-4 py-1.5 bg-stone-200/50 backdrop-blur-sm text-stone-800 text-xs font-bold font-magic uppercase tracking-widest border border-stone-400 shadow-sm stagger-${i+1}">
          ${tag}
        </span>
      `).join('');

      const secondaryHtml = secondary.map(comm => `
        <div class="flex items-center p-3 bg-white border border-stone-300 rounded shadow-sm hover:scale-[1.02] transition-transform">
          <div class="w-1.5 h-10 ${comm.color} mr-4 rounded-full"></div>
          <div>
            <span class="font-bold text-stone-800 font-magic text-lg block">${comm.name}</span>
            <span class="text-xs text-stone-500 uppercase tracking-wide font-bold">${comm.fullName}</span>
          </div>
        </div>
      `).join('');

      app.innerHTML = `
        <div class="max-w-md w-full relative z-10 anim-entrance-result">
          <div class="bg-[#f0e6d2] overflow-hidden rounded-lg shadow-[0_0_100px_rgba(0,0,0,0.8)] border-4 border-double border-stone-500 transform transition-all hover:scale-[1.01]">
            <div class="absolute inset-0 opacity-15 bg-[url('https://www.transparenttextures.com/patterns/aged-paper.png')] pointer-events-none mix-blend-multiply"></div>

            <div class="${primary.color} p-12 text-center relative border-b-8 border-double border-amber-500/30 overflow-hidden">
              <div class="absolute inset-0 bg-black/20 mix-blend-overlay"></div>
              <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,rgba(255,255,255,0.2)_0%,transparent_70%)]"></div>
              
              <div class="relative z-10 flex flex-col items-center">
                <div class="bg-slate-900/90 p-6 rounded-full mb-6 border-2 border-amber-400 shadow-[0_0_50px_rgba(245,158,11,0.6)] animate-[float-card_4s_ease-in-out_infinite]">
                  <i data-lucide="${primary.icon}" class="w-16 h-16 text-amber-400 drop-shadow-[0_0_10px_rgba(251,191,36,1)]"></i>
                </div>
                
                <p class="text-amber-200 text-sm font-bold font-magic uppercase tracking-[0.4em] mb-3 drop-shadow-md">Veredito Final</p>
                <h1 class="text-6xl font-black text-white font-magic tracking-tight drop-shadow-[0_4px_8px_rgba(0,0,0,0.6)] leading-none mb-2">${primary.name}</h1>
                
                <div class="flex items-center gap-4 w-full justify-center opacity-80 my-4">
                   <div class="h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent flex-1"></div>
                   <i data-lucide="star" class="w-3 h-3 text-amber-300 fill-amber-300"></i>
                   <div class="h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent flex-1"></div>
                </div>
                
                <p class="text-amber-100 font-magic font-bold text-lg tracking-wide uppercase shadow-black drop-shadow-md">${primary.fullName}</p>
              </div>
            </div>

            <div class="p-8 md:p-10 relative">
              <p class="text-stone-800 text-xl leading-relaxed text-center font-body italic mb-10 drop-shadow-sm">
                "${primary.description}"
              </p>

              <div class="flex flex-wrap gap-3 justify-center mb-10">
                ${tagsHtml}
              </div>

              <div class="mb-10 bg-stone-900/5 p-6 rounded-lg border border-stone-300">
                <h3 class="text-xs font-bold text-stone-500 font-magic uppercase tracking-[0.2em] mb-6 text-center">
                  Casas Aliadas
                </h3>
                <div class="space-y-3 font-body">
                  ${secondaryHtml}
                </div>
              </div>

              <button onclick="resetQuiz()" class="w-full py-5 border-2 border-stone-400 text-stone-600 font-bold font-magic text-lg uppercase tracking-widest hover:bg-slate-900 hover:text-amber-400 hover:border-slate-900 transition-all duration-300 flex items-center justify-center gap-3 shadow-md group">
                <i data-lucide="refresh-cw" class="w-5 h-5 group-hover:rotate-180 transition-transform duration-700"></i> 
                Nova Consulta
              </button>
            </div>
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    window.resetQuiz = function() {
      scores = { SCOME: 0, SCOPH: 0, SCORA: 0, SCORP: 0 };
      currentQuestion = 0;
      renderWelcome();
    };

    // --- 5. INICIALIZAÇÃO ---
    initParticles();
    renderWelcome();

  </script>
</body>
</html>